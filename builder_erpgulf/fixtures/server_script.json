[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-11-14 11:08:56.703503",
  "module": "Builder ERPGulf",
  "name": "Cost Performance Index (CPI)",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Project",
  "script": "# Calculate Cost Performance Index (CPI)\r\nif doc.custom_earned_value and doc.custom_actual_cost:\r\n    if doc.custom_actual_cost != 0:\r\n        doc.custom_cost_performance_index = round(doc.custom_earned_value / doc.custom_actual_cost, 2)\r\n    else:\r\n        doc.custom_cost_performance_index = 0\r\nelse:\r\n    doc.custom_cost_performance_index = 0\r\n\r\n# Determine status\r\nif doc.custom_cost_performance_index > 1:\r\n    doc.custom_cpi_status = \"Good\"\r\nelif doc.custom_cost_performance_index == 1:\r\n    doc.custom_cpi_status = \"On Budget\"\r\nelif doc.custom_cost_performance_index < 1:\r\n    doc.custom_cpi_status = \"Over Budget\"\r\nelse:\r\n    doc.custom_cpi_status = \"\"\r\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-11-17 12:14:35.074468",
  "module": "Builder ERPGulf",
  "name": "Schedule Variance (SV)",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Project",
  "script": "pv = doc.custom_planned_value or 0\r\nev = doc.custom_earned_value or 0\r\n\r\n# Calculate SV\r\ndoc.custom_schedule_variance = ev - pv\r\n\r\n# Status Logic\r\nif doc.custom_schedule_variance > 0:\r\n    doc.custom_sv_status = \"Ahead\"\r\nelif doc.custom_schedule_variance == 0:\r\n    doc.custom_sv_status = \"On Time\"\r\nelse:\r\n    doc.custom_sv_status = \"Behind\"\r\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-11-17 12:29:24.682914",
  "module": "Builder ERPGulf",
  "name": "Cost Variance (CV)",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Project",
  "script": "ev = doc.custom_earned_value or 0\r\nac = doc.custom_actual_cost or 0\r\n\r\n# Calculate CV\r\ndoc.custom_cost_variance = ev - ac\r\n\r\n# Status Logic\r\nif doc.custom_cost_variance > 0:\r\n    doc.custom_cv_status = \"Under Budget\"\r\nelif doc.custom_cost_variance == 0:\r\n    doc.custom_cv_status = \"On Budget\"\r\nelse:\r\n    doc.custom_cv_status = \"Over Budget\"\r\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-11-25 09:38:58.177871",
  "module": "Builder ERPGulf",
  "name": "Risk Register",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Project",
  "script": "# Probability/Impact scoring map\r\nscore_map = {\r\n    \"high\": 3,\r\n    \"medium\": 2,\r\n    \"low\": 1\r\n}\r\n\r\nfor row in (doc.custom_risk_register_table or []):\r\n    # Convert to numeric values\r\n    prob = score_map.get((row.probability or \"\").lower(), 0)\r\n    imp = score_map.get((row.impact or \"\").lower(), 0)\r\n\r\n    # Calculate Risk Score\r\n    row.risk_score = prob * imp\r\n\r\n    # Determine Risk Category\r\n    score = row.risk_score\r\n\r\n    if score >= 7:\r\n        row.risk_category = \"Critical\"\r\n    elif score >= 4:\r\n        row.risk_category = \"High\"\r\n    elif score >= 2:\r\n        row.risk_category = \"Medium\"\r\n    elif score == 1:\r\n        row.risk_category = \"Low\"\r\n    else:\r\n        row.risk_category = \"Not Applicable\"\r\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-11-26 13:27:25.605102",
  "module": "Builder ERPGulf",
  "name": "Stakeholder Matrix",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Project",
  "script": "# Map for scores\r\nscore_map = {\r\n    \"high\": 3,\r\n    \"medium\": 2,\r\n    \"low\": 1\r\n}\r\n\r\nfor row in (doc.custom_stakeholder_matrix or []):\r\n    inf = score_map.get((row.influence or \"\").lower(), 0)\r\n    inte = score_map.get((row.interest or \"\").lower(), 0)\r\n\r\n    score = inf * inte\r\n\r\n    # Determine category\r\n    if score >= 7:\r\n        row.category = \"Manage Closely\"\r\n    elif score >= 4:\r\n        row.category = \"Keep Satisfied\"\r\n    elif score >= 2:\r\n        row.category = \"Keep Informed\"\r\n    elif score == 1:\r\n        row.category = \"Monitor\"\r\n    else:\r\n        row.category = \"Undefined\"\r\n",
  "script_type": "DocType Event"
 }
]